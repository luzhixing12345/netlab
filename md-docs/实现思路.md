
# 实现思路

首先需要明确几个问题, 整个过程是由 server 向 client 发送数据包, client 向 server 回复对应的 ACK 确认以保证可靠传输

client 需要知道的信息是**完整文件的大小**, 这样可以在本地创建一个等大文件, 直接将数据写到文件对应的位置而不需要全部接收之后才写入

server 需要知道的信息是**RTT**, 因为 server 需要接收来自 client 的 ACK 确认, 以保证发送的数据包全部到达, 因此需要设置一个 ACK 的超时时间, 发送数据后 RTT 内没有按时收到来自 client 的 ACK 确认则认为该数据包丢失, 重发

> 选择重传机制, 这里的定时器实际采用的是 `2 * RTT`, 即多等待一会儿 ACK 确认帧再重发

## 模拟 TCP 三次握手

初次建立连接由 client 发起, 发送一个 SYN 数据包. 数据包的内容不重要, 只是为了通知 server 说明 client已经就绪.

![20231226171801](https://raw.githubusercontent.com/learner-lu/picbed/master/20231226171801.png)


![20231226171334](https://raw.githubusercontent.com/learner-lu/picbed/master/20231226171334.png)

## 参考

- [TCP SYN 超时重传机制](https://zhuanlan.zhihu.com/p/483856828)
- [Linux中TCP设置syn超时时间](https://www.jianshu.com/p/84edd4eecf20)

- [可靠数据传输协议 RDT 探究](https://blog.csdn.net/qq_38505990/article/details/80603007)
- [计算机网络-运输层总结](https://jasonxqh.github.io/2021/05/03/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E8%BF%90%E8%BE%93%E5%B1%82%E6%80%BB%E7%BB%93/)
- [网络协议7:[传输层]可靠传输(rdt)的原理](https://juejin.cn/post/7030066301062086670)
- [可靠数据传输原理](https://yieldnull.com/blog/943b65e3a64843303b8f15e1acbf79a77ace947f/)
- [how-to-design-rdt](https://sunsetwan.github.io/2020/11/27/how-to-design-rdt/)